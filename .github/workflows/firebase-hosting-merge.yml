# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on merge
'on':
  push:
    branches: [ main, dev ]
jobs:
  build_and_deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Install firebase tools
        run: |
          sudo npm install -g firebase-tools --unsafe
          firebase use lzz-personalblog --token ${{ secrets.FIREBASE_TOKEN }}
      - name: Build website
        run: |
          yarn
          yarn build
          
      - name: Deploy to dev site
        if: github.ref == 'refs/heads/staging'
        run: firebase deploy --only hosting:dev --non-interactive --token ${{ secrets.FIREBASE_TOKEN }} -m "${{ github.event.head_commit.message }}"
        
      - name: Deploy to production site
        if: github.ref == 'refs/heads/master'
        run: firebase deploy --only hosting:main --non-interactive --token ${{ secrets.FIREBASE_TOKEN }} -m "${{ github.event.head_commit.message }}"

      - name: Archive build Artifact
        uses: actions/upload-artifact@master
        with:
          path: build
